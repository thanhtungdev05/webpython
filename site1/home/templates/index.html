{% extends 'base.html' %}
{% load static %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<!-- N·∫øu base.html ch∆∞a c√≥ Bootstrap Icons, uncomment d√≤ng d∆∞·ªõi:
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
-->
{% endblock %}

{% block content %}
<!-- HERO CAROUSEL -->
<section class="hero-section">
  <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-indicators">
      {% for dest in destinations %}
      <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="{{ forloop.counter0 }}"
              class="{% if forloop.first %}active{% endif %}" aria-label="Slide {{ forloop.counter }}"></button>
      {% endfor %}
    </div>

    <div class="carousel-inner rounded-4 shadow-lg overflow-hidden">
      {% for dest in destinations %}
      <div class="carousel-item {% if forloop.first %}active{% endif %}">
        <img src="{{ dest.image_url }}" class="d-block w-100 hero-img" alt="{{ dest.name }}">
        <div class="carousel-caption hero-caption">
          <div class="hero-caption-inner">
            <h1 class="hero-title">{{ dest.name }}</h1>
            <p class="hero-sub">{{ dest.description|truncatewords:18 }}</p>
            <div class="hero-ctas">
              <a href="{% url 'tour_from_destination' dest.id %}" class="btn btn-lg btn-primary me-2">Kh√°m ph√°</a>
              <a href="{% url 'tour_list' %}" class="btn btn-lg btn-outline-light">Xem t·∫•t c·∫£ tour</a>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="carousel-item active">
        <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1600" class="d-block w-100 hero-img" alt="beach">
        <div class="carousel-caption hero-caption">
          <div class="hero-caption-inner">
            <h1 class="hero-title">Kh√°m ph√° nh·ªØng b√£i bi·ªÉn tuy·ªát ƒë·∫πp</h1>
            <p class="hero-sub">C√πng ch√∫ng t√¥i t·∫≠n h∆∞·ªüng k·ª≥ ngh·ªâ m∆° ∆∞·ªõc c·ªßa b·∫°n.</p>
            <div class="hero-ctas">
              <a href="{% url 'tour_list' %}" class="btn btn-lg btn-primary me-2">Kh√°m ph√°</a>
              <a href="{% url 'contact' %}" class="btn btn-lg btn-outline-light">Li√™n h·ªá</a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</section>

<!-- SEARCH (2 h√†ng - S2 r√∫t g·ªçn) -->
<section class="search-section">
  <div class="container">
    <div class="search-card mx-auto shadow-lg">
      <form method="GET" action="{% url 'tour_list' %}" class="row g-3 align-items-center">

        <!-- Row 1 -->
        <div class="col-lg-6">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-geo-alt-fill"></i></span>
            <input type="text" class="form-control" id="destination" name="destination" placeholder="ƒêi·ªÉm ƒë·∫øn, v√≠ d·ª•: Nha Trang" autocomplete="off">
          </div>
          <ul id="destination-suggestions" class="suggestions"></ul>
        </div>

        <div class="col-lg-6">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
            <input type="date" class="form-control" id="date" name="date">
          </div>
        </div>

        <!-- Row 2 -->
        <div class="col-lg-4">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-currency-dollar"></i></span>
            <input type="number" class="form-control" id="min_price" name="min_price" placeholder="Gi√° t·ª´ (VNƒê)">
          </div>
        </div>

        <div class="col-lg-4">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-cash-stack"></i></span>
            <input type="number" class="form-control" id="max_price" name="max_price" placeholder="ƒê·∫øn (VNƒê)">
          </div>
        </div>

        <div class="col-lg-4 d-grid">
          <button type="submit" class="btn btn-primary btn-lg">üîç T√¨m ki·∫øm</button>
        </div>

      </form>
    </div>
  </div>
</section>

<!-- üå¥ TOUR N·ªîI B·∫¨T (KEEP AS-IS) -->
<section class="py-5">
  <div class="container">
    <div class="text-center mb-5">
      <h2 class="fw-bold text-primary">Tour n·ªïi b·∫≠t</h2>
      <p class="text-muted">Nh·ªØng h√†nh tr√¨nh ƒë∆∞·ª£c y√™u th√≠ch nh·∫•t</p>
    </div>

    {% if tours %}
      <div class="row g-4">
        {% for tour in tours %}
        <div class="col-md-4">
          <div class="card border-0 shadow-sm h-100">
            <img src="{{ tour.image_url }}" class="card-img-top" alt="{{ tour.title }}">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title fw-semibold">{{ tour.title }}</h5>
              <p class="card-meta text-secondary small mb-2">
                {{ tour.destination.name }} ‚Ä¢ {{ tour.duration }}
              </p>
              <p class="card-text text-muted flex-grow-1">
                {{ tour.description|default:tour.schedule|truncatewords:25 }}
              </p>
              <a href="{% url 'tour_detail' tour.id %}" class="btn btn-outline-primary w-100 mt-2">Xem chi ti·∫øt</a>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-5">
        <img src="{% static 'images/empty-tour.svg' %}" width="150" class="mb-3 opacity-75">
        <h5 class="fw-bold text-muted">Hi·ªán ch∆∞a c√≥ tour n√†o n·ªïi b·∫≠t</h5>
        <a href="{% url 'tour_list' %}" class="btn btn-primary mt-3">Xem t·∫•t c·∫£ tour</a>
      </div>
    {% endif %}
  </div>
</section>



    <!-- dots -->
    <div class="d-flex justify-content-center mt-3">
      <div id="testiDots" class="testi-dots"></div>
    </div>
  </div>
</section>

<!-- üìû CONTACT CTA -->
<section class="contact-cta py-5">
  <div class="container">
    <div class="contact-cta-card p-4 rounded-4 shadow-lg d-flex flex-column flex-md-row align-items-center justify-content-between">
      <div>
        <h3 class="mb-1">B·∫°n c·∫ßn t∆∞ v·∫•n cho chuy·∫øn ƒëi?</h3>
        <p class="mb-0 text-muted">G·ªçi cho ch√∫ng t√¥i ho·∫∑c g·ª≠i y√™u c·∫ßu ‚Äî ch√∫ng t√¥i s·∫Ω thi·∫øt k·∫ø h√†nh tr√¨nh ph√π h·ª£p.</p>
      </div>
      <div class="mt-3 mt-md-0">
        <a href="{% url 'contact' %}" class="btn btn-lg btn-primary me-3">Li√™n h·ªá ngay</a>
        <a href="tel:+84000000000" class="btn btn-outline-secondary btn-lg">G·ªçi: 1900 0000</a>
      </div>
    </div>
  </div>
</section>

<!-- SCRIPTS -->
<script src="{% static 'js/autocomplete.js' %}"></script>
<script>
  // Testimonial slider (vanilla JS)
  (function(){
    const slider = document.getElementById('testimonialSlider');
    const items = Array.from(slider.querySelectorAll('.testi-item'));
    const dotsContainer = document.getElementById('testiDots');
    const prevBtn = document.getElementById('testiPrev');
    const nextBtn = document.getElementById('testiNext');
    let current = 0;
    let interval = null;
    const delay = 4500;

    function buildDots(){
      items.forEach((_, idx) => {
        const d = document.createElement('button');
        d.className = 'testi-dot';
        d.setAttribute('aria-label','Slide '+(idx+1));
        d.addEventListener('click', ()=> goTo(idx));
        dotsContainer.appendChild(d);
      });
    }

    function update(){
      items.forEach((it, i) => {
        it.style.transform = `translateX(${(i - current) * 100}%)`;
        it.style.opacity = (i === current) ? '1' : '0.45';
        it.style.pointerEvents = (i === current) ? 'auto' : 'none';
      });
      // update dots
      Array.from(dotsContainer.children).forEach((d, i) => {
        d.classList.toggle('active', i === current);
      });
    }

    function goTo(i){
      current = (i + items.length) % items.length;
      update();
      resetInterval();
    }

    function next(){
      goTo(current + 1);
    }

    function prev(){
      goTo(current - 1);
    }

    function startInterval(){
      interval = setInterval(next, delay);
    }

    function resetInterval(){
      if(interval) clearInterval(interval);
      startInterval();
    }

    // init
    items.forEach((it, i) => {
      it.style.position = 'absolute';
      it.style.top = 0;
      it.style.left = 0;
      it.style.width = '100%';
      it.style.transition = 'transform 600ms cubic-bezier(.2,.8,.2,1), opacity 300ms';
      it.style.transform = `translateX(${i * 100}%)`;
    });

    buildDots();
    update();
    startInterval();

    // controls
    if(prevBtn) prevBtn.addEventListener('click', ()=>{ prev(); });
    if(nextBtn) nextBtn.addEventListener('click', ()=>{ next(); });

    // pause on hover
    const container = document.querySelector('.testimonial-slider');
    container.addEventListener('mouseenter', ()=> { if(interval) clearInterval(interval); });
    container.addEventListener('mouseleave', ()=> { resetInterval(); });

    // responsive fallback: if items <=1 hide controls & dots
    if(items.length <= 1){
      dotsContainer.style.display = 'none';
      if(prevBtn) prevBtn.style.display = 'none';
      if(nextBtn) nextBtn.style.display = 'none';
    }
  })();
</script>

{% endblock %}
